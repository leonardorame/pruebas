angular.module('TIRApp.controllers.stats', []).
  controller('statsController', function($scope, TIRAPIservice, $http, $cookieStore) {
    $scope.TIRAPIservice = TIRAPIservice;

    // Chart.js Data
    $scope.data = {
      title: 'AAAAA',
      labels: [],
      datasets: [
        {
          label: 'CR',
          fillColor: "green",
          highlightStroke: "green",
          data: []
        },
        {
          label: 'CT',
          fillColor: "orange",
          highlightStroke: "orange",
          data: []
        },
        {
          label: 'MR',
          fillColor: "red",
          highlightStroke: "red",
          data: []
        },
        {
          label: 'US',
          fillColor: 'yellow',
          highlightStroke: 'yellow',
          data: []
        }

      ]
    };

    $http({
            method: 'GET',
            url: '/cgi-bin/tir/stats/byModalityLast12Months',
            headers: {"Content-Type": 'application/json; charset=UTF-8'}
        }).error( function(data, status, headers, config) {
          console.log('error');
        }).success( function(all, status, headers, config) {
            var studiesbymodality = all.studiesbymodality;
            for(var i = 0; i < studiesbymodality.length; i++) {
                $scope.data.labels.push(studiesbymodality[i].Year + '/' + studiesbymodality[i].Month);
            };
            for(i = 0; i < studiesbymodality.length; i++) {
                $scope.data.datasets[0].data.push(studiesbymodality[i].CR);
                $scope.data.datasets[1].data.push(studiesbymodality[i].CT);
                $scope.data.datasets[2].data.push(studiesbymodality[i].MR);
                $scope.data.datasets[3].data.push(studiesbymodality[i].US);
            };
     }); 

    // Chart.js Options
    $scope.options =  {
      // Sets the chart to be responsive
      responsive: true,
      ///Boolean - Whether grid lines are shown across the chart
      scaleShowGridLines : true,
      //String - Colour of the grid lines
      scaleGridLineColor : "rgba(0,0,0,.05)",
      //Number - Width of the grid lines
      scaleGridLineWidth : 1,
      //Boolean - Whether the line is curved between points
      bezierCurve : true,
      //Number - Tension of the bezier curve between points
      bezierCurveTension : 0.4,
      //Boolean - Whether to show a dot for each point
      pointDot : true,
      //Number - Radius of each point dot in pixels
      pointDotRadius : 4,
      //Number - Pixel width of point dot stroke
      pointDotStrokeWidth : 1,
      //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
      pointHitDetectionRadius : 20,
      //Boolean - Whether to show a stroke for datasets
      datasetStroke : true,
      //Number - Pixel width of dataset stroke
      datasetStrokeWidth : 2,
      //Boolean - Whether to fill the dataset with a colour
      datasetFill : true,
      // Function - on animation progress
      onAnimationProgress: function(){},
      // Function - on animation complete
      onAnimationComplete: function(){},
      //String - A legend template
      legendTemplate : '<div class="tc-chart-js-legend" style="display: inline-block; height: 24px;"><% for (var i=0; i<datasets.length; i++){%><div style="float: left; width: 20px; height: 20px; margin-right: 4px; background-color:<%=datasets[i].fillColor%>"></div><div style="float: left; width: 50px; text-align: left;"><%=datasets[i].label%></div><%}%></div>'
    };
})
